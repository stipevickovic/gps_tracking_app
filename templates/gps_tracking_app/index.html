<!DOCTYPE html>
<html lang="en" dir="ltr" style="height: 100%;">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  crossorigin=""></script>
  <title>Map</title>
</head>
<body style="height: 100%;">
  
  <div id="mapid" style="width: 100%; height: 100%;"></div>
  <script>

    console.log("<b>Hello world!</b><br />I am a popup.");
    // console.log(typeof({{location}}));

    var mymap = L.map('mapid').setView([44.107752, 15.261269], 13);

    var Stamen_TonerBackground = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.{ext}', {
    	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    	subdomains: 'abcd',
    	minZoom: 0,
    	maxZoom: 20,
    	ext: 'png'
    }).addTo(mymap);

    var ws = new WebSocket("ws://127.0.0.1:8000/ws/gps/00679391F46E8D8E/");
    ws.onmessage = function (event) {
      console.log(typeof(JSON.parse(event.data)));
      var message = JSON.parse(event.data)
      console.log(message.lat);
      L.marker(
      [message.lat, message.long]
      ).addTo(mymap);

      mymap.setView([message.lat, message.long], 13)
    }


  </script>
</body>
</html>
